

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Quickstart &mdash; drom master
 (209f01d
) (2020/08/28 18:40) documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/fixes.css" type="text/css" />
    <link rel="author" title="About these documents" href="about.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Project Description" href="reference.html" />
    <link rel="prev" title="About" href="about.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> drom
          

          
          </a>

          
            
            
              <div class="version">
                master
 (209f01d
)
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference external" href="https://ocamlpro.github.io/drom">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="about.html">About</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Quickstart</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#general-purpose">General Purpose</a></li>
<li class="toctree-l2"><a class="reference internal" href="#creating-a-project-with-drom">Creating a Project with <code class="code docutils literal notranslate"><span class="pre">drom</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#building-a-project-with-drom">Building a Project with <code class="code docutils literal notranslate"><span class="pre">drom</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="#building-locally">Building locally</a></li>
<li class="toctree-l3"><a class="reference internal" href="#building-with-a-global-opam-switch">Building with a global <code class="code docutils literal notranslate"><span class="pre">opam</span></code> switch</a></li>
<li class="toctree-l3"><a class="reference internal" href="#installing-the-project">Installing the Project</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="reference.html">Project Description</a></li>
<li class="toctree-l1"><a class="reference internal" href="commands.html">Sub-commands and Arguments</a></li>
<li class="toctree-l1"><a class="reference internal" href="config.html">User Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="github.html">Github Projects</a></li>
<li class="toctree-l1"><a class="reference internal" href="licenses.html">Managing Licenses</a></li>
<li class="toctree-l1"><a class="reference internal" href="install.html">How to install</a></li>
<li class="toctree-l1"><a class="reference external" href="https://ocamlpro.github.io/drom/doc">API doc</a></li>
<li class="toctree-l1"><a class="reference internal" href="license.html">Copyright and License</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/ocamlpro/drom">Devel and Issues on Github</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">drom</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Quickstart</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/quickstart.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="quickstart">
<h1>Quickstart<a class="headerlink" href="#quickstart" title="Permalink to this headline">¶</a></h1>
<div class="section" id="general-purpose">
<h2>General Purpose<a class="headerlink" href="#general-purpose" title="Permalink to this headline">¶</a></h2>
<p><code class="code docutils literal notranslate"><span class="pre">drom</span></code> has two purposes:</p>
<ul class="simple">
<li>It’s a tool to easily create OCaml projects: <code class="code docutils literal notranslate"><span class="pre">drom</span> <span class="pre">new</span>
<span class="pre">PROJECT</span></code> will create a complete OCaml project, with all the required
files for <code class="code docutils literal notranslate"><span class="pre">opam</span></code> and <code class="code docutils literal notranslate"><span class="pre">dune</span></code>, plus additional files for
documentation (Sphinx and Github Pages) and CI (Github Actions).</li>
<li>It’s a tool to build and install the project, combining calls to
<cite>opam</cite> and <cite>dune</cite> to create a local switch, install dependencies,
build the project and its documentation</li>
</ul>
</div>
<div class="section" id="creating-a-project-with-drom">
<h2>Creating a Project with <code class="code docutils literal notranslate"><span class="pre">drom</span></code><a class="headerlink" href="#creating-a-project-with-drom" title="Permalink to this headline">¶</a></h2>
<p>Let’s suppose we want to create a new project <code class="code docutils literal notranslate"><span class="pre">hello_world</span></code>. We
can use <cite>drom</cite> to create almost everything we need for that!</p>
<p>Let’s create the project:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="o">$</span> <span class="n">drom</span> <span class="k">new</span> <span class="n">hello_world</span>
<span class="nc">Loading</span> <span class="n">config</span> <span class="n">from</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">user</span><span class="o">/.</span><span class="n">config</span><span class="o">/</span><span class="n">drom</span>
<span class="nc">Creating</span> <span class="n">directory</span> <span class="n">hello_world</span>
<span class="nc">Creating</span> <span class="n">file</span> <span class="n">drom</span><span class="o">.</span><span class="n">toml</span>
<span class="nc">Creating</span> <span class="n">file</span> <span class="o">.</span><span class="n">gitignore</span>
<span class="nc">Creating</span> <span class="n">file</span> <span class="nc">Makefile</span>
<span class="nc">Creating</span> <span class="n">file</span> <span class="nn">README</span><span class="p">.</span><span class="n">md</span>
<span class="nc">Creating</span> <span class="n">file</span> <span class="n">src</span><span class="o">/</span><span class="n">dune</span>
<span class="nc">Creating</span> <span class="n">file</span> <span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="o">.</span><span class="n">ml</span>
<span class="nc">Creating</span> <span class="n">file</span> <span class="nn">CHANGES</span><span class="p">.</span><span class="n">md</span>
<span class="nc">Calling</span> <span class="n">git</span> <span class="n">init</span>
<span class="nc">Initialized</span> <span class="n">empty</span> <span class="nc">Git</span> <span class="n">repository</span> <span class="k">in</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">hello_world</span><span class="o">/.</span><span class="n">git</span><span class="o">/</span>
<span class="nc">Calling</span> <span class="n">git</span> <span class="n">add</span> <span class="nn">README</span><span class="p">.</span><span class="n">md</span>
<span class="nc">Calling</span> <span class="n">git</span> <span class="n">commit</span> <span class="o">-</span><span class="n">m</span> <span class="nc">Initial</span> <span class="n">commit</span>
<span class="o">[</span><span class="n">master</span> <span class="o">(</span><span class="n">root</span><span class="o">-</span><span class="n">commit</span><span class="o">)</span> <span class="mi">7</span><span class="n">fef447</span><span class="o">]</span> <span class="nc">Initial</span> <span class="n">commit</span>
<span class="mi">1</span> <span class="n">file</span> <span class="n">changed</span><span class="o">,</span> <span class="mi">14</span> <span class="n">insertions</span><span class="o">(+)</span>
<span class="n">create</span> <span class="n">mode</span> <span class="mi">100644</span> <span class="nn">README</span><span class="p">.</span><span class="n">md</span>
<span class="nc">Creating</span> <span class="n">file</span> <span class="n">docs</span><span class="o">/</span><span class="n">index</span><span class="o">.</span><span class="n">html</span>
<span class="nc">Creating</span> <span class="n">file</span> <span class="n">docs</span><span class="o">/</span><span class="n">style</span><span class="o">.</span><span class="n">css</span>
<span class="nc">Creating</span> <span class="n">file</span> <span class="n">docs</span><span class="o">/</span><span class="n">doc</span><span class="o">/</span><span class="n">index</span><span class="o">.</span><span class="n">html</span>
<span class="nc">Creating</span> <span class="n">file</span> <span class="n">docs</span><span class="o">/</span><span class="n">sphinx</span><span class="o">/</span><span class="n">index</span><span class="o">.</span><span class="n">html</span>
<span class="nc">Creating</span> <span class="n">file</span> <span class="n">docs</span><span class="o">/.</span><span class="n">nojekyll</span>
<span class="nc">Creating</span> <span class="n">file</span> <span class="n">sphinx</span><span class="o">/</span><span class="n">conf</span><span class="o">.</span><span class="n">py</span>
<span class="nc">Creating</span> <span class="n">file</span> <span class="n">sphinx</span><span class="o">/</span><span class="n">index</span><span class="o">.</span><span class="n">rst</span>
<span class="nc">Creating</span> <span class="n">file</span> <span class="n">sphinx</span><span class="o">/</span><span class="n">install</span><span class="o">.</span><span class="n">rst</span>
<span class="nc">Creating</span> <span class="n">file</span> <span class="n">sphinx</span><span class="o">/</span><span class="n">license</span><span class="o">.</span><span class="n">rst</span>
<span class="nc">Creating</span> <span class="n">file</span> <span class="n">sphinx</span><span class="o">/</span><span class="n">about</span><span class="o">.</span><span class="n">rst</span>
<span class="nc">Creating</span> <span class="n">file</span> <span class="n">sphinx</span><span class="o">/_</span><span class="n">static</span><span class="o">/</span><span class="n">css</span><span class="o">/</span><span class="n">fixes</span><span class="o">.</span><span class="n">css</span>
<span class="nc">Creating</span> <span class="n">file</span> <span class="n">dune</span><span class="o">-</span><span class="n">project</span>
<span class="nc">Creating</span> <span class="n">file</span> <span class="o">.</span><span class="n">ocamlformat</span>
<span class="nc">Creating</span> <span class="n">file</span> <span class="o">.</span><span class="n">github</span><span class="o">/</span><span class="n">workflows</span><span class="o">/</span><span class="n">ci</span><span class="o">.</span><span class="n">ml</span>
<span class="nc">Creating</span> <span class="n">file</span> <span class="o">.</span><span class="n">github</span><span class="o">/</span><span class="n">workflows</span><span class="o">/</span><span class="n">workflow</span><span class="o">.</span><span class="n">yml</span>
<span class="nc">Creating</span> <span class="n">file</span> <span class="n">hello_world</span><span class="o">.</span><span class="n">opam</span>
<span class="nc">Creating</span> <span class="n">file</span> <span class="nn">LICENSE</span><span class="p">.</span><span class="n">md</span>
<span class="nc">Calling</span> <span class="n">git</span> <span class="n">add</span> <span class="o">.</span><span class="n">drom</span> <span class="nn">LICENSE</span><span class="p">.</span><span class="n">md</span> <span class="n">hello_world</span><span class="o">.</span><span class="n">opam</span> <span class="o">.</span><span class="n">github</span><span class="o">/</span><span class="n">workflows</span><span class="o">/</span><span class="n">workflow</span><span class="o">.</span><span class="n">yml</span> <span class="o">.</span><span class="n">github</span><span class="o">/</span><span class="n">workflows</span><span class="o">/</span><span class="n">ci</span><span class="o">.</span><span class="n">ml</span> <span class="o">.</span><span class="n">ocamlformat</span> <span class="n">dune</span><span class="o">-</span><span class="n">project</span> <span class="n">sphinx</span><span class="o">/_</span><span class="n">static</span><span class="o">/</span><span class="n">css</span><span class="o">/</span><span class="n">fixes</span><span class="o">.</span><span class="n">css</span> <span class="n">sphinx</span><span class="o">/</span><span class="n">about</span><span class="o">.</span><span class="n">rst</span> <span class="n">sphinx</span><span class="o">/</span><span class="n">license</span><span class="o">.</span><span class="n">rst</span> <span class="n">sphinx</span><span class="o">/</span><span class="n">install</span><span class="o">.</span><span class="n">rst</span> <span class="n">sphinx</span><span class="o">/</span><span class="n">index</span><span class="o">.</span><span class="n">rst</span> <span class="n">sphinx</span><span class="o">/</span><span class="n">conf</span><span class="o">.</span><span class="n">py</span> <span class="n">docs</span><span class="o">/.</span><span class="n">nojekyll</span> <span class="n">docs</span><span class="o">/</span><span class="n">sphinx</span><span class="o">/</span><span class="n">index</span><span class="o">.</span><span class="n">html</span> <span class="n">docs</span><span class="o">/</span><span class="n">doc</span><span class="o">/</span><span class="n">index</span><span class="o">.</span><span class="n">html</span> <span class="n">docs</span><span class="o">/</span><span class="n">style</span><span class="o">.</span><span class="n">css</span> <span class="n">docs</span><span class="o">/</span><span class="n">index</span><span class="o">.</span><span class="n">html</span> <span class="nn">CHANGES</span><span class="p">.</span><span class="n">md</span> <span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="o">.</span><span class="n">ml</span> <span class="n">src</span><span class="o">/</span><span class="n">dune</span> <span class="nn">README</span><span class="p">.</span><span class="n">md</span> <span class="nn">Makefile</span> <span class="p">.</span><span class="n">gitignore</span> <span class="n">drom</span><span class="o">.</span><span class="n">toml</span>
</pre></div>
</div>
<p>As you can see, <code class="code docutils literal notranslate"><span class="pre">drom</span></code> created a directory <code class="code docutils literal notranslate"><span class="pre">hello_world</span></code>
with the following files:</p>
<ul class="simple">
<li><code class="code docutils literal notranslate"><span class="pre">drom.toml</span></code> for project management by <code class="code docutils literal notranslate"><span class="pre">drom</span></code></li>
<li><code class="code docutils literal notranslate"><span class="pre">.gitignore</span></code> and <code class="code docutils literal notranslate"><span class="pre">.git/</span></code> for the <code class="code docutils literal notranslate"><span class="pre">git</span></code> revision
control tool</li>
<li><code class="code docutils literal notranslate"><span class="pre">docs/index.html</span></code> and <code class="code docutils literal notranslate"><span class="pre">docs/style.css</span></code> for the project
homepage</li>
<li><code class="code docutils literal notranslate"><span class="pre">sphinx/</span></code> directory for the Sphinx documentation formatter</li>
<li><code class="code docutils literal notranslate"><span class="pre">README.md</span></code>, <cite>CHANGES.md</cite> and <cite>LICENSE.md</cite> project files</li>
<li><code class="code docutils literal notranslate"><span class="pre">src/main.ml</span></code> code example</li>
<li><code class="code docutils literal notranslate"><span class="pre">dune-project</span></code>, <code class="code docutils literal notranslate"><span class="pre">hello_world.opam</span></code> and <cite>src/dune</cite> for the
<code class="code docutils literal notranslate"><span class="pre">dune</span></code> build tool</li>
<li><code class="code docutils literal notranslate"><span class="pre">.github/</span></code> for Github Actions CI</li>
<li><code class="code docutils literal notranslate"><span class="pre">.ocamlformat</span></code> for the <code class="code docutils literal notranslate"><span class="pre">ocamlformat</span></code> code formatting tool</li>
</ul>
<p>At this point, you may decide that <code class="code docutils literal notranslate"><span class="pre">drom</span></code> has done enough for
you, and you can go back to using <code class="code docutils literal notranslate"><span class="pre">opam</span></code> and <code class="code docutils literal notranslate"><span class="pre">dune</span></code> to
work on your project.</p>
<p>The <code class="code docutils literal notranslate"><span class="pre">drom.toml</span></code> file has a particular importance, it can be used
by <code class="code docutils literal notranslate"><span class="pre">drom</span></code> to update all the generated files with this
information. It contains information on the project, such as its name,
license, description, dependencies, etc.</p>
<p>Everytime you modify <code class="code docutils literal notranslate"><span class="pre">drom.toml</span></code>, you should call <code class="code docutils literal notranslate"><span class="pre">drom</span>
<span class="pre">new</span></code> again to update the project:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="o">$</span> <span class="n">cd</span> <span class="n">hello_world</span>
<span class="o">$</span> <span class="n">emacs</span> <span class="n">drom</span><span class="o">.</span><span class="n">toml</span>
<span class="o">$</span> <span class="n">drom</span> <span class="k">new</span>
<span class="nc">Loading</span> <span class="n">config</span> <span class="n">from</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">user</span><span class="o">/.</span><span class="n">drom</span><span class="o">/</span><span class="n">config</span>
<span class="nc">Loading</span> <span class="n">drom</span><span class="o">.</span><span class="n">toml</span>
<span class="nn">Loading</span> <span class="p">.</span><span class="n">drom</span>
<span class="nc">Updating</span> <span class="n">file</span> <span class="n">src</span><span class="o">/</span><span class="n">dune</span>
<span class="nc">Updating</span> <span class="n">file</span> <span class="n">dune</span><span class="o">-</span><span class="n">project</span>
<span class="nc">Updating</span> <span class="n">file</span> <span class="n">hello_world</span><span class="o">.</span><span class="n">opam</span>
<span class="nc">Calling</span> <span class="n">git</span> <span class="n">add</span> <span class="o">.</span><span class="n">drom</span> <span class="n">hello_world</span><span class="o">.</span><span class="n">opam</span> <span class="n">dune</span><span class="o">-</span><span class="n">project</span> <span class="n">src</span><span class="o">/</span><span class="n">dune</span>
</pre></div>
</div>
<p>Here, we added a dependency in the <cite>drom.toml</cite> file:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="o">...</span>
<span class="o">[</span><span class="n">dependencies</span><span class="o">]</span>
<span class="n">ez_file</span> <span class="o">=</span> <span class="s2">&quot;0.1.0&quot;</span>
<span class="o">...</span>
</pre></div>
</div>
<p>And we see that <code class="code docutils literal notranslate"><span class="pre">drom</span></code> updated the files <code class="code docutils literal notranslate"><span class="pre">src/dune</span></code>,
<code class="code docutils literal notranslate"><span class="pre">dune-project</span></code> and <code class="code docutils literal notranslate"><span class="pre">hello_world.opam</span></code>.</p>
<p><code class="code docutils literal notranslate"><span class="pre">drom</span> <span class="pre">new</span></code> also takes a few command line options that can be
used to modify the <code class="code docutils literal notranslate"><span class="pre">drom.toml</span></code> file:</p>
<ul class="simple">
<li><code class="code docutils literal notranslate"><span class="pre">--upgrade</span></code> can be used to upgrade the <code class="code docutils literal notranslate"><span class="pre">drom.toml</span></code> file
when you are using a more recent version of <code class="code docutils literal notranslate"><span class="pre">drom</span></code></li>
<li><code class="code docutils literal notranslate"><span class="pre">--binary</span></code> and <code class="code docutils literal notranslate"><span class="pre">--javascript</span></code> can be used to switch between
generating binaries and generating Javascript using
<code class="code docutils literal notranslate"><span class="pre">js_of_ocaml</span></code>.</li>
<li><code class="code docutils literal notranslate"><span class="pre">--program</span></code>, <code class="code docutils literal notranslate"><span class="pre">--library</span></code> and <code class="code docutils literal notranslate"><span class="pre">--both</span></code> can be used
to switch between building a program, a library or both.</li>
</ul>
<p>Notice that, just after creating the project, you should be able to
build it and run it with no error!</p>
</div>
<div class="section" id="building-a-project-with-drom">
<h2>Building a Project with <code class="code docutils literal notranslate"><span class="pre">drom</span></code><a class="headerlink" href="#building-a-project-with-drom" title="Permalink to this headline">¶</a></h2>
<p><code class="code docutils literal notranslate"><span class="pre">drom</span></code> can be used to build a project. In this case, it will use
<code class="code docutils literal notranslate"><span class="pre">opam</span></code> to manage the environment (dependencies) and <code class="code docutils literal notranslate"><span class="pre">dune</span></code>
to build the project. You don’t need to know these tools for basic
usage of <code class="code docutils literal notranslate"><span class="pre">drom</span></code>.</p>
<p>Because <code class="code docutils literal notranslate"><span class="pre">drom</span></code> makes extensive use of local <code class="code docutils literal notranslate"><span class="pre">opam</span></code>
switches, it is a good idea to use it from <code class="code docutils literal notranslate"><span class="pre">opam-bin</span></code> to benefit
from binary caching of packages, to speedup creation of local
switches.</p>
<div class="section" id="building-locally">
<h3>Building locally<a class="headerlink" href="#building-locally" title="Permalink to this headline">¶</a></h3>
<p>By default, <code class="code docutils literal notranslate"><span class="pre">drom</span></code> will try to build the project in its directory:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span>$ cd hello_world
$ drom build -y
Loading drom.toml
Loading .drom
Loading config from /home/user/.config/drom/config
Calling opam switch create -y . --empty
Calling opam install -y ocaml.4.10.0
The following actions will be performed:
  ∗ install base-bigarray       base
  ∗ install base-threads        base
  ∗ install base-unix           base
  ∗ install ocaml-base-compiler 4.10.0                     [required by ocaml]
  ∗ install ocaml-config        1                          [required by ocaml]
  ∗ install ocaml               4.10.0
===== ∗ 6 =====

&lt;&gt;&lt;&gt; Gathering sources &gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;
[ocaml-base-compiler.4.10.0] found in cache

&lt;&gt;&lt;&gt; Processing actions &lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;
∗ installed base-bigarray.base
∗ installed base-threads.base
∗ installed base-unix.base
∗ installed ocaml-base-compiler.4.10.0
∗ installed ocaml-config.1
∗ installed ocaml.4.10.0
Done.
# Run eval $(opam env) to update the current shell environment
Calling opam switch set-base ocaml
Calling opam install -y --deps-only ./_drom/new.opam
The following actions will be performed:
∗ install dune 2.7.0

&lt;&gt;&lt;&gt; Gathering sources &gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;
[dune.2.7.0] found in cache

&lt;&gt;&lt;&gt; Processing actions &lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;
∗ installed dune.2.7.0
Done.
# Run eval $(opam env) to update the current shell environment
Calling opam exec -- dune build
Done: 40/46 (jobs: 1)
Build OK
</pre></div>
</div>
<p>During this build, <code class="code docutils literal notranslate"><span class="pre">drom</span></code> performed the following operations:</p>
<ul class="simple">
<li>It loads the project definition file <code class="code docutils literal notranslate"><span class="pre">drom.toml</span></code></li>
<li>It creates a local <code class="code docutils literal notranslate"><span class="pre">opam</span></code> switch (directory <code class="code docutils literal notranslate"><span class="pre">_opam</span></code>)
where it installs the version of OCaml specified in the
<code class="code docutils literal notranslate"><span class="pre">edition</span></code> field of the project definition</li>
<li>It installs all the dependencies of the package. In our simple example,
it is only the <code class="code docutils literal notranslate"><span class="pre">dune</span></code> build tool.</li>
<li>Once the environment is ok, it builds the project using <code class="code docutils literal notranslate"><span class="pre">dune</span></code>.</li>
</ul>
<p>Since building the environment can take some time, it is important to
know that it is only done the first time. It will also be upgraded
only if the dependencies are changed.</p>
<p>We can now run the program:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="o">$</span> <span class="n">drom</span> <span class="n">run</span>
<span class="nc">Loading</span> <span class="n">drom</span><span class="o">.</span><span class="n">toml</span>
<span class="nn">Loading</span> <span class="p">.</span><span class="n">drom</span>
<span class="nc">Loading</span> <span class="n">config</span> <span class="n">from</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">user</span><span class="o">/.</span><span class="n">config</span><span class="o">/</span><span class="n">drom</span><span class="o">/</span><span class="n">config</span>
<span class="nc">In</span> <span class="n">opam</span> <span class="n">switch</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">hello_world</span><span class="o">/_</span><span class="n">opam</span>
<span class="nc">Calling</span> <span class="n">opam</span> <span class="n">exec</span> <span class="o">--</span> <span class="n">dune</span> <span class="n">build</span>
<span class="nc">Done</span><span class="o">:</span> <span class="mi">0</span><span class="o">/</span><span class="mi">0</span> <span class="o">(</span><span class="n">jobs</span><span class="o">:</span> <span class="mi">0</span><span class="o">)</span>
<span class="nc">Calling</span> <span class="n">opam</span> <span class="n">exec</span> <span class="o">--</span> <span class="n">dune</span> <span class="n">exec</span> <span class="o">-</span><span class="n">p</span> <span class="n">hello_world</span> <span class="o">--</span> <span class="n">hello_world</span>
<span class="nc">Hello</span> <span class="n">world</span><span class="o">!</span>
</pre></div>
</div>
<p>It’s a bit verbose, but the last line <code class="code docutils literal notranslate"><span class="pre">Hello</span> <span class="pre">world!</span></code> was printed
by our project!</p>
</div>
<div class="section" id="building-with-a-global-opam-switch">
<h3>Building with a global <code class="code docutils literal notranslate"><span class="pre">opam</span></code> switch<a class="headerlink" href="#building-with-a-global-opam-switch" title="Permalink to this headline">¶</a></h3>
<p><code class="code docutils literal notranslate"><span class="pre">drom</span></code> can use global switches also. For example, if you want to
install the project in that switch:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="o">$</span> <span class="n">drom</span> <span class="n">build</span> <span class="o">--</span><span class="n">switch</span> <span class="mi">4</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">0</span>
<span class="nc">Loading</span> <span class="n">drom</span><span class="o">.</span><span class="n">toml</span>
<span class="nn">Loading</span> <span class="p">.</span><span class="n">drom</span>
<span class="nc">Loading</span> <span class="n">config</span> <span class="n">from</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">user</span><span class="o">/.</span><span class="n">config</span><span class="o">/</span><span class="n">drom</span><span class="o">/</span><span class="n">config</span>
<span class="nc">Error</span><span class="o">:</span> <span class="nc">You</span> <span class="n">must</span> <span class="n">remove</span> <span class="n">the</span> <span class="n">local</span> <span class="n">switch</span> <span class="o">`_</span><span class="n">opam</span><span class="o">`</span> <span class="n">before</span> <span class="n">using</span> <span class="n">option</span> <span class="o">--</span><span class="n">global</span>
</pre></div>
</div>
<p>Since we previously built the project locally, we have a local
<code class="code docutils literal notranslate"><span class="pre">_opam</span></code> switch. <code class="code docutils literal notranslate"><span class="pre">drom</span></code> will not remove this switch
automatically, because it is often long to rebuild. So, you will have
to do it yourself (or backup it if you are not using
<code class="code docutils literal notranslate"><span class="pre">opam-bin</span></code>):</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="o">$</span> <span class="n">rm</span> <span class="o">-</span><span class="n">rf</span> <span class="o">_</span><span class="n">opam</span>
<span class="o">$</span> <span class="n">drom</span> <span class="n">build</span> <span class="o">--</span><span class="n">switch</span> <span class="mi">4</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">0</span>
<span class="nc">Loading</span> <span class="n">drom</span><span class="o">.</span><span class="n">toml</span>
<span class="nn">Loading</span> <span class="p">.</span><span class="n">drom</span>
<span class="nc">Loading</span> <span class="n">config</span> <span class="n">from</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">user</span><span class="o">/.</span><span class="n">config</span><span class="o">/</span><span class="n">drom</span><span class="o">/</span><span class="n">config</span>
<span class="nc">Calling</span> <span class="n">opam</span> <span class="n">switch</span> <span class="n">link</span> <span class="mi">4</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">0</span>
<span class="nc">Directory</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">hello_world</span> <span class="n">set</span> <span class="k">to</span> <span class="n">use</span> <span class="n">switch</span> <span class="mi">4</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span>
<span class="nc">Just</span> <span class="n">remove</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">hello_world</span><span class="o">/_</span><span class="n">opam</span> <span class="k">to</span> <span class="n">unlink</span><span class="o">.</span>
<span class="nc">In</span> <span class="n">opam</span> <span class="n">switch</span> <span class="mi">4</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">0</span>
<span class="nc">Calling</span> <span class="n">opam</span> <span class="n">install</span> <span class="o">--</span><span class="n">deps</span><span class="o">-</span><span class="n">only</span> <span class="o">./_</span><span class="n">drom</span><span class="o">/</span><span class="k">new</span><span class="o">.</span><span class="n">opam</span>
<span class="nc">Nothing</span> <span class="k">to</span> <span class="k">do</span><span class="o">.</span>
<span class="o">#</span> <span class="nc">Run</span> <span class="n">eval</span> <span class="o">$(</span><span class="n">opam</span> <span class="n">env</span><span class="o">)</span> <span class="k">to</span> <span class="n">update</span> <span class="n">the</span> <span class="n">current</span> <span class="n">shell</span> <span class="n">environment</span>
<span class="nc">Calling</span> <span class="n">opam</span> <span class="n">exec</span> <span class="o">--</span> <span class="n">dune</span> <span class="n">build</span>
<span class="nc">Build</span> <span class="nc">OK</span>
</pre></div>
</div>
<p><code class="code docutils literal notranslate"><span class="pre">drom</span></code> performed exactly the same steps as for a local build.
In our case, the <code class="code docutils literal notranslate"><span class="pre">opam</span></code> switch <code class="code docutils literal notranslate"><span class="pre">4.10.0</span></code> already existed on
our computer, and the dependencies were already installed, so it only
built the project.</p>
<p>However, if the switch specified by <code class="code docutils literal notranslate"><span class="pre">--switch</span></code> does not exist
globally, <code class="code docutils literal notranslate"><span class="pre">drom</span></code> will call <code class="code docutils literal notranslate"><span class="pre">opam</span></code> to create it.</p>
</div>
<div class="section" id="installing-the-project">
<h3>Installing the Project<a class="headerlink" href="#installing-the-project" title="Permalink to this headline">¶</a></h3>
<p>Now that we have tested that our project correctly builds in a local
switch and in a global switch, we can ask <code class="code docutils literal notranslate"><span class="pre">drom</span></code> to install it
in the switch:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span>$ drom install
Loading drom.toml
Loading .drom
Loading config from /home/user/.config/drom/config
Directory /tmp/hello_world set to use switch 4.07.0.
Just remove /tmp/hello_world/_opam to unlink.
In opam switch 4.07.0
Calling opam install --deps-only ./_drom/new.opam
Nothing to do.
Calling opam exec -- dune build
Calling opam uninstall -y hello_world
The following actions will be performed:
  ⊘ remove hello_world 0.1.0

&lt;&gt;&lt;&gt; Processing actions &lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;
  ⊘ removed   hello_world.0.1.0
Done.
Calling opam pin -y --no-action -k path .
Package hello_world does not exist, create as a NEW package? [Y/n] y
[hello_world.~dev] synchronised from file:///tmp/hello_world
hello_world is now pinned to file:///tmp/hello_world (version 0.1.0)
Calling opam install -y hello_world

&lt;&gt;&lt;&gt; Synchronising pinned packages &gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;
[hello_world.0.1.0] no changes from file:///tmp/hello_world

The following actions will be performed:
  ∗ install hello_world 0.1.0*

&lt;&gt;&lt;&gt; Processing actions &lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;
∗ installed hello_world.0.1.0
Done.
Calling opam unpin -n hello_world
Ok, hello_world is no longer pinned to file:///tmp/hello_world (version 0.1.0)
Installation OK
</pre></div>
</div>
<p>As we can see in this example, <code class="code docutils literal notranslate"><span class="pre">drom</span></code> performed the following steps:</p>
<ul class="simple">
<li>Building the project, as in the previous sections</li>
<li>Removing all the packages of the project that may already be installed</li>
<li>Pinning all the packages for <code class="code docutils literal notranslate"><span class="pre">opam</span></code></li>
<li>Installing the pinned packages (rebuilding them in <code class="code docutils literal notranslate"><span class="pre">opam</span></code>)</li>
<li>Unpinning all the packages</li>
</ul>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="reference.html" class="btn btn-neutral float-right" title="Project Description" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="about.html" class="btn btn-neutral float-left" title="About" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright OCamlPro SAS &amp; Origin Labs SAS

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>